### **キャンペーン適用を考慮したテーブル一覧（マスタ系 & トランザクション系）**  

---

## **🟢 1. マスタ系テーブル（事前に登録されるデータ）**
マスタ系テーブルは、**キャンペーンの基本情報や適用条件** などを管理する。  
比較的 **更新頻度は低く**、`SELECT` で参照されることが多い。  

### **📌 (1) キャンペーンマスタ（Campaign）**
| カラム名       | 型            | 説明                                 |
| -------------- | ------------- | ------------------------------------ |
| campaign_id    | SERIAL (PK)   | キャンペーンの一意なID               |
| campaign_name  | VARCHAR(255)  | キャンペーン名                       |
| discount_type  | VARCHAR(50)   | 割引の種類 (`percentage` or `fixed`) |
| discount_value | DECIMAL(10,2) | 割引額（% or 固定額）                |
| start_date     | DATE          | 開始日                               |
| end_date       | DATE          | 終了日                               |

---

### **📌 (2) キャンペーン適用条件マスタ（CampaignCondition）**
1つのキャンペーンに **複数の適用条件を設定できる**。  
（例: 最低購入金額 + 特定の商品を含む など）  

| カラム名        | 型           | 説明                                                     |
| --------------- | ------------ | -------------------------------------------------------- |
| condition_id    | SERIAL (PK)  | 一意なID                                                 |
| campaign_id     | INT (FK)     | キャンペーンID (`Campaign` 参照)                         |
| condition_type  | VARCHAR(50)  | 条件の種類 (`min_order_amount`, `product_id` など)       |
| condition_value | VARCHAR(255) | 条件の値（最小注文金額なら「10000」、商品IDなら「101」） |

---

## **🟠 2. トランザクション系テーブル（注文時に生成されるデータ）**
トランザクション系テーブルは、**注文が発生した際に記録されるデータ** を管理する。  
頻繁に `INSERT`・`UPDATE` される。

---

### **📌 (3) 注文テーブル（Order）**
| カラム名        | 型            | 説明                     |
| --------------- | ------------- | ------------------------ |
| order_id        | SERIAL (PK)   | 注文ID                   |
| customer_id     | INT (FK)      | 顧客ID                   |
| order_date      | DATE          | 注文日                   |
| total_amount    | DECIMAL(10,2) | 注文金額（割引前）       |
| discount_amount | DECIMAL(10,2) | 割引額                   |
| final_amount    | DECIMAL(10,2) | 最終的な支払額（割引後） |

---

### **📌 (4) 注文明細テーブル（OrderDetail）**
| カラム名        | 型            | 説明                  |
| --------------- | ------------- | --------------------- |
| order_detail_id | SERIAL (PK)   | 注文明細ID            |
| order_id        | INT (FK)      | 注文ID (`Order` 参照) |
| product_id      | INT (FK)      | 商品ID                |
| quantity        | INT           | 数量                  |
| price           | DECIMAL(10,2) | 単価                  |

---

### **📌 (5) 注文キャンペーン適用履歴（OrderCampaign）**
注文全体に適用されたキャンペーンを記録する。  
（例: 「合計10,000円以上で10%オフ」など）

| カラム名          | 型            | 説明                                       |
| ----------------- | ------------- | ------------------------------------------ |
| order_campaign_id | SERIAL (PK)   | 一意なID                                   |
| order_id          | INT (FK)      | 対象の注文ID (`Order` 参照)                |
| campaign_id       | INT (FK)      | 適用されたキャンペーンID (`Campaign` 参照) |
| discount_amount   | DECIMAL(10,2) | 割引額                                     |

---

### **📌 (6) 注文明細キャンペーン適用履歴（OrderDetailCampaign）**
特定の商品に適用されたキャンペーンを記録する。  
（例: 「特定の商品 101 に20%オフが適用された」など）

| カラム名                 | 型            | 説明                                       |
| ------------------------ | ------------- | ------------------------------------------ |
| order_detail_campaign_id | SERIAL (PK)   | 一意なID                                   |
| order_detail_id          | INT (FK)      | 対象の明細ID (`OrderDetail` 参照)          |
| campaign_id              | INT (FK)      | 適用されたキャンペーンID (`Campaign` 参照) |
| discount_amount          | DECIMAL(10,2) | 割引額                                     |

---

## **🟣 3. マスタ系とトランザクション系の関係**
```
[Campaign] 1 --------< N [CampaignCondition]  
      |  
      v  
[OrderCampaign]  
      |  
      v  
[Order] --------< [OrderDetail] --------< [OrderDetailCampaign]
```

---

## **🔵 4. まとめ**
| テーブル名                     | 説明                             | 備考                                  |
| ------------------------------ | -------------------------------- | ------------------------------------- |
| **マスタ系テーブル**           |                                  |                                       |
| `Campaign`                     | キャンペーンの基本情報           | 1つのキャンペーンを定義               |
| `CampaignCondition`            | キャンペーンの適用条件           | 1つのキャンペーンに複数条件を設定可能 |
| **トランザクション系テーブル** |                                  |                                       |
| `Order`                        | 注文情報                         |                                       |
| `OrderDetail`                  | 注文明細（商品ごとの購入情報）   |                                       |
| `OrderCampaign`                | 注文全体に適用されたキャンペーン | 例: 10,000円以上で10%オフ             |
| `OrderDetailCampaign`          | 商品ごとに適用されたキャンペーン | 例: 商品ID 101 のみ20%オフ            |

---

## **🟢 5. この設計のメリット**
✅ **柔軟なキャンペーン設定が可能**
   - 1つのキャンペーンに **複数の適用条件を設定できる**
   - **注文全体** に適用するキャンペーンと **特定の商品だけ** に適用するキャンペーンを分けて管理できる  

✅ **後からデータ分析しやすい**
   - `OrderCampaign` や `OrderDetailCampaign` に適用履歴が残るため、  
     「どのキャンペーンがどれくらい適用されたか？」が分析できる  

---

